@using Uploadify.Client.Application.Utilities.Services
@using Uploadify.Client.Web.Components.Navigation
@inject MobileViewManager MobileViewManager
@inject IStringLocalizer<TranslationDictionary> Localizer

<MudBreakpointProvider OnBreakpointChanged="OnBreakpointChanged"/>

<PermissionView>
    <Authorized Context="AuthenticationState">
        <MudContainer Class="pa-0"
                      MaxWidth="@MaxWidth.Large"
                      Style="height: 100vh; width: 100%;">
            <MudLayout Style="height: 100vh; width: 100%;">
                <MudAppBar Class="pt-8 px-4"
                           Elevation="0"
                           Fixed="false">
                    <MudStack AlignItems="AlignItems.Center"
                              Row="true"
                              Spacing="4">
                        <MudImage Alt="brand logo"
                                  ObjectFit="@ObjectFit.ScaleDown"
                                  ObjectPosition="@ObjectPosition.Center"
                                  Src="icons/brand-logo.svg"
                                  Width="34">
                        </MudImage>
                        <MudText Inline
                                 Typo="@Typo.h2">
                            @Localizer[Translations.Common.AppName]
                        </MudText>
                    </MudStack>
                    <MudSpacer/>
                    <MudIconButton Icon="@Icons.Material.Rounded.Search"/>
                    <Avatar User="AuthenticationState.User"/>
                    <LocaleSelector/>
                </MudAppBar>
                @if (MobileViewManager.IsDesktop)
                {
                    <DesktopNavigation/>
                }
                else
                {
                    <MobileNavigation/>
                }

                <MudMainContent Class="@_mainContentClass">
                    <MudContainer Class="mud-width-full mud-height-full"
                                  MaxWidth="@MaxWidth.Small">
                        @Body
                    </MudContainer>
                </MudMainContent>
            </MudLayout>
        </MudContainer>
    </Authorized>
</PermissionView>

@code {
    private bool _isAuthenticated;
    private string _mainContentClass => MobileViewManager.IsDesktop ? "mud-width-full mud-height-full pa-8" : "mud-width-full mud-height-full px-4 py-8";
    private MaxWidth _contentWidth => MobileViewManager.IsDesktop ? MaxWidth.Medium : MaxWidth.False;

    [Parameter] public RenderFragment? Body { get; set; }

    private void OnBreakpointChanged(Breakpoint breakpoint)
    {
        switch (breakpoint)
        {
            case Breakpoint.Xs or Breakpoint.Sm or Breakpoint.Md:
            case Breakpoint.SmAndDown or Breakpoint.MdAndDown or Breakpoint.LgAndDown:
            case Breakpoint.SmAndUp:
                MobileViewManager.IsDesktop = false;
                return;

            default:
                MobileViewManager.IsDesktop = true;
                return;
        }
    }

}
